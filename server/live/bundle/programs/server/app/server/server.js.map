{"version":3,"sources":["meteor://ðŸ’»app/server/server.js"],"names":[],"mappings":"yBAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"/server/server.js","sourcesContent":["IMAGE_PATH = process.env.IMAGE_PATH;\n\nif (!IMAGE_PATH) {\n  throw \"IMAGE_PATH not set\";\n}\n\nfunction generateUsername(username) {\n  username = username.toLowerCase().trim().replace(\" \", \"\");\n  var count = Meteor.users.find({\"username\": username}).count();\n  if (count === 0) {\n    return username;\n  } else {\n    return username + (count + 1).toString();\n  }\n}\n\nAccounts.onCreateUser(function (options, user) {\n    if (options && options.profile) {\n        user.profile = options.profile;\n    }\n\n    var serviceData = {};\n    if (user.services) {\n        var service = _.pairs(user.services)[0];\n\n        var serviceName = service[0];\n        serviceData = service[1] || {};\n\n        if (serviceName == \"facebook\") {\n            user.emails = [\n                {\"address\": serviceData.email, \"verified\": true},\n            ];\n            user.profile = {\"first_name\": serviceData.first_name, \"last_name\": serviceData.last_name, \"avatar\": getFbPicture(serviceData.id)};\n        } else if (serviceName == \"google\") {\n            user.emails = [\n                {\"address\": serviceData.email, \"verified\": true},\n            ];\n            user.profile = {\"first_name\": serviceData.given_name, \"last_name\": serviceData.family_name, \"avatar\": getGooglePicture(serviceData.id)};\n        }\n    }\n\n    user.username = generateUsername(user.username || serviceData.username || serviceData.first_name || serviceData.given_name || \"unnamed\");\n\n    return user;\n});\n\n"]}