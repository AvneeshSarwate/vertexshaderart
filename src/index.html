<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>vertexshaderart.com</title>
    <link rel="stylesheet" href="css/main.css">
  </head>
  <body>
    <canvas id="c"></canvas>
    <div id="uicontainer">
      <div id="ui">
        <div id="toolbar">
          <button id="hide"></button>
          <button id="time" class="tooltip-bottom" data-tooltip="reset time">T</button>
          <button id="new" class="tooltip-bottom" data-tooltip="new/fork">+</button>
          <button id="save">save</button>
          <select id="mode">
            <option>POINTS</option>
            <option>LINE_STRIP</option>
            <option>LINE_LOOP</option>
            <option>LINES</option>
            <option>TRI_STRIP</option>
            <option>TRI_FAN</option>
            <option>TRIANGLES</option>
          </select>
          <select id="size">
            <option>NATIVE</option>
            <option>CSS</option>
          </select>
          <input type="range" id="numRange" value="10000" min="1" max="100000" />
          <input type="number" id="num" value="10000" min="1" max="100000" />
          <input type="color" id="background" value="#4488CC" />
          <input type="text" id="sound" value="sound" />
          <button id="play"></button>
          <a target="_blank" id="gallery">gallery</a>
          <button id="help">help</button>
        </div>
        <div id="editorWrap">
          <div id="editor"></div>
        </div>
        <div id="soundInfo">
          <a target="_blank" id="soundcloud"><img src="https://developers.soundcloud.com/assets/logo_white-af5006050dd9cba09b0c48be04feac57.png" /></a>
          <a target="_blank" id="bandLink"></a>
          <a target="_blank" id="soundLink"></a>
        </div>
      </div>
    </div>
    <div id="helpDialog" class="fulldialog" style="display: none;">
      <pre>
==================[ vertexshaderart.com ]====================
UI
-------------------------------------------------------------
[T]      : Resets the time to 0
[+]      : Makes a new art piece from the current one
[Save]   : Saves the current art
[mode]   : Choose a mode POINTS, LINES, LINE_LOOP, LINE_STRIP
[NATIVE] : Lines are native size (1 pixel) or CSS size
           On HD-DPI display CSS will generate thicker lines
[sound]  : A soundcloud URL for music
           The URL must have permission to embedded

Inputs
-------------------------------------------------------------
vertexId  : float     : number of the vertex 0, 1, 2
resoluton : vec2      : resolution of the art
mouse     : vec2      : mouse position normalized (-1 to 1)
time      : float     : time in seconds
sound     : sampler2D : data from the music Nx240, alpha only
                      : 240 rows of history (4secs @60fps)
soundRes  : vec2      : resolution of sound
      </pre>
    </div>
  </body>
<script id="vs-header" type="notjs">
attribute float vertexId;

uniform vec2 mouse;
uniform vec2 resolution;
uniform float time;
uniform sampler2D sound;
uniform vec2 soundRes;
uniform float _dontUseDirectly_pointSize;

varying vec4 v_color;
</script>
<script id="vs" type="notjs">#define PI 3.14159
#define NUM_SEGMENTS 21.0
#define NUM_POINTS (NUM_SEGMENTS * 2.0)
#define STEP 5.0
//#define FIT_VERTICAL

vec3 hsv2rgb(vec3 c) {
  c = vec3(c.x, clamp(c.yz, 0.0, 1.0));
  vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
  vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
  return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}

void main() {
  float localTime = time + 20.0;
  float point = mod(floor(vertexId / 2.0) + mod(vertexId, 2.0) * STEP, NUM_SEGMENTS);
  float count = floor(vertexId / NUM_POINTS);
  float offset = count * 0.02;
  float angle = point * PI * 2.0 / NUM_SEGMENTS + offset;
  float radius = 0.2;
  float c = cos(angle + localTime) * radius;
  float s = sin(angle + localTime) * radius;
  float orbitAngle = count * 0.01;
  float oC = cos(orbitAngle + localTime * count * 0.01) * sin(orbitAngle);
  float oS = sin(orbitAngle + localTime * count * 0.01) * sin(orbitAngle);

  #ifdef FIT_VERTICAL
    vec2 aspect = vec2(resolution.y / resolution.x, 1);
  #else
    vec2 aspect = vec2(1, resolution.x / resolution.y);
  #endif

  vec2 xy = vec2(
      oC + c,
      oS + s);
  gl_Position = vec4(xy * aspect + mouse * 0.1, 0, 1);

  float hue = (localTime * 0.01 + count * 1.001);
  v_color = vec4(hsv2rgb(vec3(hue, 1, 1)), 1);
}
  </script>
  <script id="vs2" type="notjs">
#define PI 3.14159
#define NUM_SEGMENTS 4.0
#define NUM_POINTS (NUM_SEGMENTS * 2.0)
#define STEP 5.0
//#define FIT_VERTICAL

vec3 hsv2rgb(vec3 c) {
  c = vec3(c.x, clamp(c.yz, 0.0, 1.0));
  vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
  vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
  return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}

void main() {
  float localTime = time + 20.0;
  float point = mod(floor(vertexId / 2.0) + mod(vertexId, 2.0) * STEP, NUM_SEGMENTS);
  float count = floor(vertexId / NUM_POINTS);
  float snd = texture2D(sound, vec2(fract(count / 128.0), fract(count / 20000.0))).a;
  float offset = count * 0.02;
  float angle = point * PI * 2.0 / NUM_SEGMENTS + offset;
  float radius = 0.2 * pow(snd, 5.0);
  float c = cos(angle + localTime) * radius;
  float s = sin(angle + localTime) * radius;
  float orbitAngle =  count * 0.0;
  float innerRadius = count * 0.001;
  float oC = cos(orbitAngle + localTime * 0.4 + count * 0.1) * innerRadius;
  float oS = sin(orbitAngle + localTime + count * 0.1) * innerRadius;

  #ifdef FIT_VERTICAL
    vec2 aspect = vec2(resolution.y / resolution.x, 1);
  #else
    vec2 aspect = vec2(1, resolution.x / resolution.y);
  #endif

  vec2 xy = vec2(
      oC + c,
      oS + s);
  gl_Position = vec4(xy * aspect + mouse * 0.1, 0, 1);

  float hue = (localTime * 0.01 + count * 1.001);
  v_color = vec4(hsv2rgb(vec3(hue, 1, 1)), 1);
}
    </script>
  <script id="fs" type="notjs">
precision mediump float;

varying vec4 v_color;

void main() {
  gl_FragColor = v_color;
}
  </script>
  <script id="history-vs" type="notjs">
attribute vec4 position;
attribute vec2 texcoord;
uniform mat4 u_matrix;
varying vec2 v_texcoord;

void main() {
  gl_Position = u_matrix * position;
  v_texcoord = texcoord;
}
  </script>
  <script id="history-fs" type="notjs">
precision mediump float;

uniform sampler2D u_texture;
varying vec2 v_texcoord;

void main() {
  gl_FragColor = texture2D(u_texture, v_texcoord).aaaa;
}
  </script>

  <script src="https://connect.soundcloud.com/sdk/sdk-3.0.0.js"></script>
  <script data-main="js/main.js" src="3rdparty/require.js"></script>
</html>
